import{e as C,P as v,t as O,j as e,R as l,H as R,h as A}from"./index-CzFFDwW4.js";import{u as w,j as E}from"./jobs.api-DIjWZGWd.js";import{u as _}from"./session.store-1UEN3RI7.js";import{t as P,c as j,n as $,p as k,M as B}from"./pt-BR-DdiBCKyI.js";import{c as J,f as F,C as h}from"./formatDistanceToNow-b4Bxw4_-.js";import{s as y,f as S}from"./format-Dg3nb9Bm.js";import{L as H}from"./log-out-BSdQ4A4L.js";import{C as I,a as M}from"./clock-B_u0nPIZ.js";import{C as g}from"./circle-check-big-Bbgtxqrf.js";import{u as U,L as u}from"./vendor-Ckni1CTx.js";import{A as q}from"./activity-CZZuPaou.js";import{A as N}from"./arrow-right-B8JQ2zer.js";import{C as V}from"./circle-stop-BFqtyt86.js";import{P as Y}from"./play-PNxERiTr.js";function z(){const{session:s}=C(),{setStatus:a,setUserInfo:i}=_(),{data:r,isLoading:c,error:t}=w({queryKey:["session-status",s?.phoneNumber],queryFn:async()=>{if(!s)throw new Error("Sessão não encontrada");const n=await O.getStatus({phone_number:s.phoneNumber,api_id:s.apiId,api_hash:s.apiHash});return a(n.status),n.user_id&&i(n.user_id,n.username),n},enabled:!!s,refetchInterval:v.SESSION_STATUS,refetchIntervalInBackground:!1}),{data:o=[],isLoading:m,error:f}=w({queryKey:["jobs",s?.phoneNumber],queryFn:async()=>s?E.getJobs(s.phoneNumber):[],enabled:!!s,refetchInterval:v.JOBS_LIST,refetchIntervalInBackground:!1}),p={totalJobs:o.length,activeJobs:o.filter(n=>n.status==="running").length,completedJobs:o.filter(n=>n.status==="completed").length,failedJobs:o.filter(n=>n.status==="failed").length,totalMessagesCopied:o.reduce((n,d)=>n+d.messages_copied,0),totalMessagesFailed:o.reduce((n,d)=>n+d.messages_failed,0)},b=n=>{const d=n.endsWith("Z")?n:`${n}Z`;return new Date(d)},T=o.sort((n,d)=>b(d.created_at).getTime()-b(n.created_at).getTime()).slice(0,5);return{sessionStatus:r,isLoadingStatus:c,statusError:t,jobs:o,isLoadingJobs:m,jobsError:f,stats:p,recentJobs:T,isLoading:c||m}}function G(s,a,i){const r=P(s,i?.in);return isNaN(a)?j(s,NaN):(r.setDate(r.getDate()+a),r)}function D(s,a,i){const[r,c]=$(i?.in,s,a);return+y(r)==+y(c)}function K(s,a){return D(j(s,s),J(s))}function Q(s,a,i){return G(s,-1,i)}function Z(s,a){return D(j(s,s),Q(J(s)))}function L(s){const a=typeof s=="string"||typeof s=="number"?new Date(s):s;return K(a)?`Hoje às ${S(a,"HH:mm")}`:Z(a)?`Ontem às ${S(a,"HH:mm")}`:F(a,{addSuffix:!0,locale:k})}function x(s){return new Intl.NumberFormat("pt-BR").format(s)}function W({status:s,isLoading:a}){const i=U(),{session:r,logout:c}=C(),{clearSession:t}=_(),o=()=>{c(),t(),i(l.LOGIN)},m=()=>a?e.jsx(I,{className:"h-5 w-5 text-warning animate-pulse"}):s?.connected?e.jsx(g,{className:"h-5 w-5 text-success"}):e.jsx(h,{className:"h-5 w-5 text-destructive"}),f=()=>a?"Verificando...":s?.connected?"Conectado":"Desconectado",p=()=>a?"text-warning":s?.connected?"text-success":"text-destructive";return e.jsxs("div",{className:"bg-card border rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Status da Sessão"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Informações da conexão do Telegram"})]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-accent rounded-md transition-colors text-muted-foreground hover:text-foreground",title:"Sair",children:e.jsx(H,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m(),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("div",{className:`font-medium ${p()}`,children:f()})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"Usuário"}),e.jsx("div",{className:"font-medium",children:r.username?`@${r.username}`:r.phoneNumber})]}),r.userId&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"ID do Usuário"}),e.jsx("div",{className:"font-mono text-sm",children:r.userId})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"Telefone"}),e.jsx("div",{className:"font-medium",children:r.phoneNumber})]})]}),s?.message&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"Mensagem"}),e.jsx("div",{className:"text-sm",children:s.message})]}),e.jsxs("div",{className:"border-t pt-4 text-xs text-muted-foreground",children:["Última atualização: ",L(new Date)]})]})]})}function X({stats:s,isLoading:a}){const i=[{title:"Jobs Ativos",value:s.activeJobs,icon:q,color:"text-primary",bgColor:"bg-primary/10"},{title:"Jobs Concluídos",value:s.completedJobs,icon:g,color:"text-success",bgColor:"bg-success/10"},{title:"Mensagens Copiadas",value:s.totalMessagesCopied,icon:B,color:"text-primary",bgColor:"bg-primary/10"},{title:"Jobs Falhados",value:s.failedJobs,icon:h,color:"text-destructive",bgColor:"bg-destructive/10"}];return a?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(r=>e.jsxs("div",{className:"bg-card border rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-8 bg-muted rounded w-16"})]},r))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:i.map(r=>e.jsxs("div",{className:"bg-card border rounded-lg p-6 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:`p-3 rounded-lg ${r.bgColor}`,children:e.jsx(r.icon,{className:`h-5 w-5 ${r.color}`})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:r.title}),e.jsx("p",{className:"text-2xl font-bold",children:x(r.value)})]})]},r.title))})}function ee({jobs:s,isLoading:a}){const i=t=>{switch(t){case"running":return e.jsx(Y,{className:"h-4 w-4 text-primary animate-pulse"});case"completed":return e.jsx(g,{className:"h-4 w-4 text-success"});case"failed":return e.jsx(h,{className:"h-4 w-4 text-destructive"});case"stopped":return e.jsx(V,{className:"h-4 w-4 text-warning"});default:return e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})}},r=t=>{switch(t){case"pending":return"Pendente";case"running":return"Em execução";case"completed":return"Concluído";case"failed":return"Falhou";case"stopped":return"Parado";default:return t}},c=t=>{switch(t){case"running":return"text-primary bg-primary/10";case"completed":return"text-success bg-success/10";case"failed":return"text-destructive bg-destructive/10";case"stopped":return"text-warning bg-warning/10";default:return"text-muted-foreground bg-muted/10"}};return a?e.jsxs("div",{className:"bg-card border rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Jobs Recentes"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"p-4 border rounded-md animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]},t))})]}):s.length===0?e.jsxs("div",{className:"bg-card border rounded-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Jobs Recentes"})}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Nenhum job encontrado"}),e.jsxs(u,{to:l.COPY,className:"inline-flex items-center gap-2 text-primary hover:underline font-medium",children:["Criar primeiro job",e.jsx(N,{className:"h-4 w-4"})]})]})]}):e.jsxs("div",{className:"bg-card border rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Jobs Recentes"}),e.jsxs(u,{to:l.JOBS,className:"text-sm text-primary hover:underline flex items-center gap-1",children:["Ver todos",e.jsx(N,{className:"h-4 w-4"})]})]}),e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsxs(u,{to:`${l.JOBS}?job=${t.id}`,className:"block p-4 border rounded-md hover:bg-accent transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("span",{className:"text-sm font-medium truncate",children:[t.source_channel," → ",t.target_channel]})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:L(t.created_at)})]}),e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${c(t.status)}`,children:[i(t.status),e.jsx("span",{children:r(t.status)})]})]}),t.status==="running"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Progresso"}),e.jsxs("span",{children:[x(t.messages_copied)," mensagens"]})]}),e.jsx("div",{className:"h-1.5 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:"100%"}})})]}),t.status==="completed"&&e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-3 w-3 text-success"}),x(t.messages_copied)," copiadas"]}),t.messages_failed>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3 text-destructive"}),x(t.messages_failed)," falhadas"]})]}),t.status==="failed"&&t.error_message&&e.jsx("div",{className:"mt-2 text-xs text-destructive",children:t.error_message})]},t.id))}),s.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs(u,{to:l.COPY,className:"flex items-center justify-center gap-2 text-sm text-primary hover:underline font-medium",children:["Criar novo job",e.jsx(N,{className:"h-4 w-4"})]})})]})}function se(){const{sessionStatus:s,isLoadingStatus:a,statusError:i,stats:r,recentJobs:c,isLoading:t}=z();return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(M,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Erro ao carregar dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Não foi possível carregar as informações. Tente recarregar a página."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Visão geral das suas atividades e jobs"})]}),e.jsx(X,{stats:r,isLoading:t}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(W,{status:s,isLoading:a})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ee,{jobs:c,isLoading:t})})]})]})}function fe(){return e.jsxs("div",{className:"flex flex-col h-screen overflow-hidden",children:[e.jsx(R,{}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(A,{}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-background",children:e.jsx("div",{className:"container mx-auto px-4 py-6 lg:px-8",children:e.jsx(se,{})})})]})]})}export{fe as DashboardPage};
