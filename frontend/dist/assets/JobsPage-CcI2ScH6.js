import{c as b,j as e,a as N,H as M,h as A,k as E}from"./index-CzFFDwW4.js";import{b as h,u as S}from"./vendor-Ckni1CTx.js";import{C as y}from"./circle-stop-BFqtyt86.js";import{C as R,f as j}from"./formatDistanceToNow-b4Bxw4_-.js";import{C as T}from"./circle-check-big-Bbgtxqrf.js";import{C,a as B,u as F}from"./useJobs-CdiVa7YV.js";import{Z as w}from"./zap-BQlWyOVR.js";import{C as I,a as Z}from"./clock-B_u0nPIZ.js";import{A as $}from"./arrow-right-B8JQ2zer.js";import{M as q,p as _}from"./pt-BR-DdiBCKyI.js";import{I as D}from"./image-CaHbtvT8.js";import"./jobs.api-DIjWZGWd.js";const H=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],k=b("funnel",H);const z=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],P=b("plus",z);const Q=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],U=b("search",Q),J=a=>{const s=a.endsWith("Z")?a:`${a}Z`;return new Date(s)},W=h.memo(function({job:s,onStop:d,onPause:m,onResume:u,onClick:x,isStoppingJob:p,isPausingJob:g,isResumingJob:i}){const r={pending:{icon:I,label:"Pendente",color:"text-muted-foreground",bgColor:"bg-muted"},running:{icon:w,label:"Em Execução",color:"text-primary",bgColor:"bg-primary/10"},paused:{icon:C,label:"Pausado",color:"text-orange-500",bgColor:"bg-orange-500/10"},completed:{icon:T,label:"Concluído",color:"text-success",bgColor:"bg-success/10"},failed:{icon:R,label:"Falhou",color:"text-destructive",bgColor:"bg-destructive/10"},stopped:{icon:y,label:"Parado",color:"text-muted-foreground",bgColor:"bg-muted"}},n=r[s.status]||r.pending,l=n.icon;return e.jsxs("div",{className:N("bg-card border rounded-lg p-4 transition-all hover:shadow-md",x&&"cursor-pointer hover:border-primary/50"),onClick:()=>x?.(s.id),children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("div",{className:N("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium",n.bgColor,n.color),children:[e.jsx(l,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:n.label})]}),s.real_time&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-primary/10 text-primary rounded-full text-xs font-medium",children:[e.jsx(w,{className:"h-3 w-3"}),e.jsx("span",{children:"Tempo Real"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium truncate",children:s.source_channel}),e.jsx($,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"font-medium truncate",children:s.target_channel})]})]})}),e.jsxs("div",{className:"mb-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(q,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Mensagens copiadas:"}),e.jsx("span",{className:"font-semibold text-foreground",children:s.messages_copied.toLocaleString("pt-BR")})]}),s.messages_failed>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Z,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"text-muted-foreground",children:"Mensagens falhadas:"}),e.jsx("span",{className:"font-semibold text-destructive",children:s.messages_failed.toLocaleString("pt-BR")})]}),s.copy_media&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(D,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Cópia de mídia ativada"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[s.created_at&&e.jsxs("span",{children:["Criado"," ",j(J(s.created_at),{addSuffix:!0,locale:_})]}),(s.started_at||s.completed_at)&&s.status!=="pending"&&e.jsxs("span",{children:["Atualizado"," ",j(J(s.completed_at||s.started_at),{addSuffix:!0,locale:_})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="running"&&m&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),m(s.id)},disabled:g,className:"px-3 py-1 text-xs font-medium bg-orange-500/10 text-orange-500 hover:bg-orange-500/20 rounded transition-colors disabled:opacity-50 flex items-center gap-1",children:[e.jsx(C,{className:"h-3 w-3"}),g?"Pausando...":"Pausar"]}),s.status==="paused"&&u&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),u(s.id)},disabled:i,className:"px-3 py-1 text-xs font-medium bg-primary/10 text-primary hover:bg-primary/20 rounded transition-colors disabled:opacity-50 flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),i?"Retomar":"Continuar"]}),(s.status==="running"||s.status==="pending"||s.status==="paused")&&d&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),d(s.id)},disabled:p,className:"px-3 py-1 text-xs font-medium bg-destructive/10 text-destructive hover:bg-destructive/20 rounded transition-colors disabled:opacity-50 flex items-center gap-1",children:[e.jsx(y,{className:"h-3 w-3"}),p?"Parando...":"Parar"]})]})]}),s.status==="failed"&&s.error_message&&e.jsxs("div",{className:"mt-3 p-2 bg-destructive/5 border border-destructive/20 rounded text-xs text-destructive",children:[e.jsx("span",{className:"font-medium",children:"Erro:"})," ",s.error_message]})]})});function X({jobs:a,onStop:s,onPause:d,onResume:m,onJobClick:u,isStoppingJob:x,isPausingJob:p,isResumingJob:g}){const i=S(),[r,n]=h.useState(""),[l,c]=h.useState("all"),f=h.useMemo(()=>{let t=a;if(l!=="all"&&(l==="completed"?t=t.filter(o=>o.status==="completed"||o.status==="stopped"):t=t.filter(o=>o.status===l)),r.trim()){const o=r.toLowerCase();t=t.filter(v=>v.source_channel.toLowerCase().includes(o)||v.target_channel.toLowerCase().includes(o)||v.id.toLowerCase().includes(o))}return t},[a,r,l]),L=[{value:"all",label:"Todos",count:a.length},{value:"running",label:"Em Execução",count:a.filter(t=>t.status==="running").length},{value:"paused",label:"Pausados",count:a.filter(t=>t.status==="paused").length},{value:"pending",label:"Pendentes",count:a.filter(t=>t.status==="pending").length},{value:"completed",label:"Concluídos",count:a.filter(t=>t.status==="completed"||t.status==="stopped").length},{value:"failed",label:"Falhados",count:a.filter(t=>t.status==="failed").length}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Jobs de Cópia"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[f.length," de ",a.length," jobs"]})]}),e.jsxs("button",{onClick:()=>i("/copy"),className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(P,{className:"h-4 w-4"}),"Novo Job"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Buscar por canal ou ID...",value:r,onChange:t=>n(t.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[e.jsx(k,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("div",{className:"flex items-center gap-2",children:L.map(t=>e.jsxs("button",{onClick:()=>c(t.value),className:N("px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors",l===t.value?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"),children:[t.label," (",t.count,")"]},t.value))})]})]}),f.length===0?e.jsx("div",{className:"bg-card border rounded-lg p-12 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"mb-4 text-muted-foreground",children:e.jsx(k,{className:"h-12 w-12 mx-auto"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum job encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:r||l!=="all"?"Tente ajustar os filtros de busca":"Crie seu primeiro job de cópia para começar"}),!r&&l==="all"&&e.jsxs("button",{onClick:()=>i("/copy"),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors font-medium",children:[e.jsx(P,{className:"h-4 w-4"}),"Criar Novo Job"]})]})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:f.map(t=>e.jsx(W,{job:t,onStop:s,onPause:d,onResume:m,onClick:u,isStoppingJob:x,isPausingJob:p,isResumingJob:g},t.id))})]})}function oe(){const a=S(),{jobs:s,isLoading:d,stopJob:m,isStoppingJob:u,pauseJob:x,isPausingJob:p,resumeJob:g,isResumingJob:i}=F(),r=n=>{a(`/jobs/${n}`)};return e.jsxs("div",{className:"flex flex-col h-screen overflow-hidden",children:[e.jsx(M,{}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(A,{}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-background",children:e.jsx("div",{className:"container mx-auto px-4 py-6 lg:px-8",children:d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(E,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx(X,{jobs:s,onStop:m,onPause:x,onResume:g,onJobClick:r,isStoppingJob:u,isPausingJob:p,isResumingJob:i})})})]})]})}export{oe as JobsPage};
