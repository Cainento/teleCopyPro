import{c as v,i as y,e as _,g as C,f as m,R as w,j as e,a as b,H as k,h as S}from"./index-CzFFDwW4.js";import{o as T,b as j,s as f,L as p,u as X,a as I}from"./schemas-DA-md1ZL.js";import{u as M,b as N}from"./vendor-Ckni1CTx.js";import{u as A,j as L}from"./jobs.api-DIjWZGWd.js";import{u as q,I as H}from"./image-CaHbtvT8.js";import{userApi as R}from"./user.api-TtPxmSth.js";import{C as U,a as E}from"./clock-B_u0nPIZ.js";import{Z as F}from"./zap-BQlWyOVR.js";import{H as P}from"./hash-Qq1vW8NH.js";import{C as J}from"./circle-check-big-Bbgtxqrf.js";import{A as D}from"./arrow-right-B8JQ2zer.js";import{P as O}from"./play-PNxERiTr.js";const B=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],Q=v("file",B),W=T({sourceChannel:f().min(1,"Canal de origem obrigatÃ³rio").refine(r=>r.startsWith("@")||r.startsWith("-")||/^\d+$/.test(r),"Use @username, -100XXXXXXXXX ou ID numÃ©rico"),targetChannel:f().min(1,"Canal de destino obrigatÃ³rio").refine(r=>r.startsWith("@")||r.startsWith("-")||/^\d+$/.test(r),"Use @username, -100XXXXXXXXX ou ID numÃ©rico"),realTime:j(),copyMedia:j()});function $(){const r=M(),s=y(),{session:t}=_(),[l,i]=N.useState(!1),{data:o,isLoading:n}=A({queryKey:["user-usage",t?.phoneNumber],queryFn:()=>{if(!t)throw new Error("SessÃ£o nÃ£o encontrada");return R.getUsageStats(t.phoneNumber)},enabled:!!t,staleTime:1e3*30,refetchInterval:1e3*60}),c=q({mutationFn:async a=>{if(!t)throw new Error("SessÃ£o nÃ£o encontrada");return L.startCopy({phone_number:t.phoneNumber,source_channel:a.sourceChannel,target_channel:a.targetChannel,real_time:a.realTime,copy_media:a.copyMedia,api_id:t.apiId,api_hash:t.apiHash})},onMutate:async()=>{m.loading("Criando job...",{id:"create-job"})},onSuccess:a=>{m.success("Job criado com sucesso!",{id:"create-job"}),s.invalidateQueries({queryKey:["jobs"]}),s.invalidateQueries({queryKey:["user-usage"]}),r(`${w.JOBS}?job=${a.job_id}`)},onError:a=>{const u=C(a);m.error(u,{id:"create-job"})}});return{handleSubmit:async a=>{if(!o){m.error("NÃ£o foi possÃ­vel verificar as permissÃµes. Tente novamente.");return}if(!o.can_create_job){m.error(o.message_limit_blocked_reason||"Limite de mensagens atingido");return}if(!a.realTime&&!o.can_create_historical_job){m.error(o.historical_job_blocked_reason||"Limite de jobs histÃ³ricos atingido");return}if(a.realTime&&!o.can_create_realtime_job){m.error(o.realtime_job_blocked_reason||"Jobs em tempo real nÃ£o disponÃ­veis no seu plano");return}await c.mutateAsync(a)},isLoading:c.isPending||n,isValidatingChannel:l,setIsValidatingChannel:i,canUseRealTime:o?.can_create_realtime_job??!1,canUseHistorical:o?.can_create_historical_job??!0,usageStats:o}}function z({value:r,onChange:s,disabled:t,canUseRealTime:l,canUseHistorical:i=!0}){const o=[{id:"historical",value:!1,icon:U,title:"CÃ³pia HistÃ³rica",description:"Copia todas as mensagens existentes do canal",features:["Copia mensagens passadas","Executa em segundo plano","Pode levar tempo dependendo do volume"],blocked:!i},{id:"realtime",value:!0,icon:F,title:"CÃ³pia em Tempo Real",description:"Copia novas mensagens conforme chegam",features:["Copia apenas mensagens novas","AtualizaÃ§Ã£o instantÃ¢nea","Fica ativo atÃ© ser parado"],blocked:!l}];return e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Modo de CÃ³pia"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(n=>{const c=n.icon,d=r===n.value,a=t||n.blocked;return e.jsxs("button",{type:"button",onClick:()=>!a&&s(n.value),disabled:a,className:b("relative p-4 border-2 rounded-lg text-left transition-all","hover:shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2",d?"border-primary bg-primary/5":"border-border hover:border-primary/50",a&&"opacity-50 cursor-not-allowed hover:border-border"),children:[n.blocked&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-destructive/10 border border-destructive rounded-full text-xs font-medium text-destructive",children:[e.jsx(p,{className:"h-3 w-3"}),e.jsx("span",{children:"Bloqueado"})]})}),e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:b("p-2 rounded-lg",d?"bg-primary text-primary-foreground":"bg-muted"),children:e.jsx(c,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description})]})]}),e.jsx("ul",{className:"space-y-1.5 text-sm",children:n.features.map((u,x)=>e.jsxs("li",{className:"flex items-start gap-2 text-muted-foreground",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"â€¢"}),e.jsx("span",{children:u})]},x))}),d&&e.jsx("div",{className:"absolute inset-0 border-2 border-primary rounded-lg pointer-events-none"})]},n.id)})})]})}const g=N.forwardRef(({label:r,error:s,helpText:t,isValidating:l,isValid:i,className:o,...n},c)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:n.id,className:"block text-sm font-medium",children:r}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsx("input",{ref:c,...n,className:b("w-full pl-10 pr-10 py-2 border rounded-md","focus:outline-none focus:ring-2 focus:ring-primary","disabled:opacity-50 disabled:cursor-not-allowed",s?"border-destructive":"border-input",o)}),(l||i)&&e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:[l&&e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-primary border-t-transparent rounded-full"}),!l&&i&&e.jsx(J,{className:"h-5 w-5 text-success"})]})]}),t&&!s&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx("span",{className:"mt-0.5",children:"ðŸ’¡"}),e.jsx("span",{children:t})]}),s&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:s})]})]}));g.displayName="ChannelInput";function K({copyMedia:r,onCopyMediaChange:s,disabled:t}){return e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"OpÃ§Ãµes de CÃ³pia"}),e.jsx("div",{className:"bg-card border rounded-lg p-4",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:l=>s(l.target.checked),disabled:t,className:"mt-1 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(H,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Copiar arquivos de mÃ­dia"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Incluir fotos, vÃ­deos, documentos e outros arquivos nas mensagens copiadas"}),e.jsx("div",{className:"mt-3 p-3 bg-muted/50 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-2 text-xs text-muted-foreground",children:[e.jsx(Q,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tipos suportados:"})," Fotos, vÃ­deos, Ã¡udios, documentos, stickers"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nota:"})," A cÃ³pia de arquivos grandes pode levar mais tempo"]})]})]})})]})]})})]})}function V(){const{handleSubmit:r,isLoading:s,canUseRealTime:t,canUseHistorical:l,usageStats:i}=$(),{register:o,handleSubmit:n,watch:c,setValue:d,formState:{errors:a}}=X({resolver:I(W),defaultValues:{sourceChannel:"",targetChannel:"",realTime:!1,copyMedia:!0},mode:"onBlur"}),u=c("realTime"),x=c("copyMedia");return e.jsxs("form",{onSubmit:n(r),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Criar Nova CÃ³pia"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure os parÃ¢metros para copiar mensagens entre canais do Telegram"})]}),e.jsxs("div",{className:"bg-card border rounded-lg p-6 space-y-6",children:[e.jsx(z,{value:u,onChange:h=>d("realTime",h),disabled:s,canUseRealTime:t,canUseHistorical:l}),i&&e.jsxs("div",{className:"space-y-3",children:[!i.can_create_realtime_job&&i.realtime_job_blocked_reason&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{className:"h-5 w-5 text-destructive mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1 text-destructive",children:"CÃ³pia em Tempo Real IndisponÃ­vel"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.realtime_job_blocked_reason})]})]})}),!i.can_create_historical_job&&i.historical_job_blocked_reason&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{className:"h-5 w-5 text-destructive mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1 text-destructive",children:"Limite de CÃ³pias HistÃ³ricas Atingido"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.historical_job_blocked_reason})]})]})}),!i.can_create_job&&i.message_limit_blocked_reason&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{className:"h-5 w-5 text-destructive mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1 text-destructive",children:"Limite de Mensagens Atingido"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.message_limit_blocked_reason})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(g,{...o("sourceChannel"),id:"sourceChannel",label:"Canal de Origem",placeholder:"@meu_canal ou -100123456789",error:a.sourceChannel?.message,helpText:"Canal de onde as mensagens serÃ£o copiadas",disabled:s}),e.jsx(g,{...o("targetChannel"),id:"targetChannel",label:"Canal de Destino",placeholder:"@canal_destino ou -100987654321",error:a.targetChannel?.message,helpText:"Canal para onde as mensagens serÃ£o copiadas",disabled:s})]}),e.jsx("div",{className:"flex justify-center lg:hidden",children:e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(D,{className:"h-5 w-5 text-muted-foreground rotate-90"})})}),e.jsx(K,{copyMedia:x,onCopyMediaChange:h=>d("copyMedia",h),disabled:s}),e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-primary",children:"â„¹ï¸"}),"InformaÃ§Ãµes Importantes"]}),e.jsxs("ul",{className:"space-y-1.5 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"â€¢"}),e.jsx("span",{children:"VocÃª precisa ser administrador do canal de destino"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Para canais privados, use o ID numÃ©rico (ex: -100123456789)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Para canais pÃºblicos, use o username com @ (ex: @meu_canal)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Jobs em tempo real ficam ativos atÃ© serem manualmente parados"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>window.history.back(),disabled:s,className:"px-6 py-2 border rounded-md hover:bg-accent transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:s,className:"flex items-center gap-2 px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:[e.jsx(O,{className:"h-4 w-4"}),s?"Criando job...":"Iniciar CÃ³pia"]})]})]})}function ce(){return e.jsxs("div",{className:"flex flex-col h-screen overflow-hidden",children:[e.jsx(k,{}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(S,{}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-background",children:e.jsx("div",{className:"container mx-auto px-4 py-6 lg:px-8 max-w-4xl",children:e.jsx(V,{})})})]})]})}export{ce as CopyPage};
