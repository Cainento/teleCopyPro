import{c as C,e as X,f as y,j as e,a as i,X as $,F,k as D,G as V,U as K,t as Y,R as O,H as W,h as Z}from"./index-CzFFDwW4.js";import{b as p,u as ee}from"./vendor-Ckni1CTx.js";import{u as se}from"./session.store-1UEN3RI7.js";import{userApi as G}from"./user.api-TtPxmSth.js";import{f as te}from"./format-Dg3nb9Bm.js";import{p as ae,M as re}from"./pt-BR-DdiBCKyI.js";import{Z as B}from"./zap-BQlWyOVR.js";import{C as oe,a as Q}from"./clock-B_u0nPIZ.js";import{P as ne}from"./phone-D8kBdd1t.js";import{L as ie}from"./log-out-BSdQ4A4L.js";const le=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ce=C("calendar",le);const de=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],L=C("check",de);const me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ue=C("circle-check",me);const xe=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],pe=C("credit-card",xe);const he=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],J=C("crown",he);const ge=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],fe=C("qr-code",ge);const be=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],je=C("trending-up",be),Ne={FREE:{maxRealTimeJobs:0,maxHistoricalJobs:3,maxMessagesPerDay:1e3,mediaSupport:!0,prioritySupport:!1},PREMIUM:{maxRealTimeJobs:5,maxHistoricalJobs:20,maxMessagesPerDay:1e4,mediaSupport:!0,prioritySupport:!0},ENTERPRISE:{maxRealTimeJobs:-1,maxHistoricalJobs:-1,maxMessagesPerDay:-1,mediaSupport:!0,prioritySupport:!0}};function ye(){const a=X(b=>b.session),[l,h]=p.useState(!0),[t,u]=p.useState(null),[r,m]=p.useState(null);p.useEffect(()=>{(async()=>{if(!a?.phoneNumber){h(!1);return}try{h(!0);const[v,S]=await Promise.all([G.getAccountInfo(a.phoneNumber),G.getUsageStats(a.phoneNumber)]);u(v),m(S)}catch(v){console.error("Error fetching account data:",v),y.error("Erro ao carregar dados da conta")}finally{h(!1)}})()},[a?.phoneNumber]);const s=(t?.plan||"free").toUpperCase(),g={phoneNumber:a?.phoneNumber||"",username:t?.display_name||a?.username,plan:s,planExpiry:t?.plan_expiry||void 0,activationKey:void 0},n=Ne[g.plan],x={realTimeJobs:{current:r?.realtime_jobs_count||0,max:r?.realtime_jobs_limit??n.maxRealTimeJobs,percentage:(r?.realtime_jobs_limit??n.maxRealTimeJobs)===-1||(r?.realtime_jobs_limit??n.maxRealTimeJobs)===null?0:Math.min(100,(r?.realtime_jobs_count||0)/(r?.realtime_jobs_limit??n.maxRealTimeJobs)*100)},historicalJobs:{current:r?.historical_jobs_count||0,max:r?.historical_jobs_limit??n.maxHistoricalJobs,percentage:(r?.historical_jobs_limit??n.maxHistoricalJobs)===-1||(r?.historical_jobs_limit??n.maxHistoricalJobs)===null?0:Math.min(100,(r?.historical_jobs_count||0)/(r?.historical_jobs_limit??n.maxHistoricalJobs)*100)},messagesPerDay:{current:r?.messages_copied_today||0,max:r?.usage_limit??n.maxMessagesPerDay,percentage:(r?.usage_limit??n.maxMessagesPerDay)===-1||(r?.usage_limit??n.maxMessagesPerDay)===null?0:Math.min(100,(r?.messages_copied_today||0)/(r?.usage_limit??n.maxMessagesPerDay)*100)}};return{accountData:g,limits:n,usage:x,isLoading:l}}const ve={FREE:{name:"Gratuito",color:"text-muted-foreground",bgColor:"bg-muted",icon:null},PREMIUM:{name:"Premium",color:"text-primary",bgColor:"bg-primary/10",icon:J},ENTERPRISE:{name:"Enterprise",color:"text-warning",bgColor:"bg-warning/10",icon:J}};function Pe({currentPlan:a,limits:l,expiryDate:h,className:t}){const u=ve[a],r=u.icon,m=s=>s===-1?"Ilimitado":s.toLocaleString("pt-BR"),c=[{label:"Jobs em Tempo Real",value:m(l.maxRealTimeJobs),enabled:l.maxRealTimeJobs!==0},{label:"Jobs Históricos",value:m(l.maxHistoricalJobs),enabled:!0},{label:"Mensagens por Dia",value:m(l.maxMessagesPerDay),enabled:!0},{label:"Suporte a Mídia",value:"Incluído",enabled:l.mediaSupport},{label:"Suporte Prioritário",value:"Incluído",enabled:l.prioritySupport}];return e.jsxs("div",{className:i("bg-card border rounded-lg p-6",t),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r&&e.jsx("div",{className:i("p-2 rounded-lg",u.bgColor),children:e.jsx(r,{className:i("h-6 w-6",u.color)})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Plano Atual"}),e.jsx("h3",{className:i("text-2xl font-bold",u.color),children:u.name})]})]}),e.jsx("div",{className:i("px-4 py-2 rounded-full text-sm font-medium",u.bgColor,u.color),children:a})]}),h&&e.jsxs("div",{className:"flex items-center gap-2 mb-6 p-3 bg-muted/50 rounded-lg",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Válido até"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:te(new Date(h),"dd 'de' MMMM 'de' yyyy",{locale:ae})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Recursos Incluídos"}),e.jsx("div",{className:"space-y-2",children:c.map((s,g)=>e.jsxs("div",{className:i("flex items-center justify-between p-3 rounded-lg transition-colors",s.enabled?"bg-success/5":"bg-muted/50"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.enabled?e.jsx(L,{className:"h-4 w-4 text-success flex-shrink-0"}):e.jsx($,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:i("text-sm",!s.enabled&&"text-muted-foreground"),children:s.label})]}),e.jsx("span",{className:i("text-sm font-medium",s.enabled?"text-success":"text-muted-foreground"),children:s.value})]},g))})]})]})}function we({realTimeJobs:a,historicalJobs:l,messagesPerDay:h,currentPlan:t="FREE",className:u}){const r=[{icon:B,label:"Jobs em Tempo Real",stat:a,color:"text-primary",bgColor:"bg-primary/10",progressColor:"bg-primary"},{icon:oe,label:"Jobs Históricos",stat:l,color:"text-warning",bgColor:"bg-warning/10",progressColor:"bg-warning"},{icon:re,label:"Mensagens Hoje",stat:h,color:"text-success",bgColor:"bg-success/10",progressColor:"bg-success"}],m=s=>s===-1?"∞":s.toLocaleString("pt-BR"),c=s=>s>=90?"text-destructive":s>=70?"text-warning":"text-success";return e.jsxs("div",{className:i("space-y-6",u),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(je,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Estatísticas de Uso"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Acompanhe seu consumo de recursos"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:r.map((s,g)=>{const n=s.icon,x=s.stat.max===-1,b=c(s.stat.percentage);return e.jsxs("div",{className:"bg-card border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:i("p-2 rounded-lg",s.bgColor),children:e.jsx(n,{className:i("h-5 w-5",s.color)})}),e.jsx("h4",{className:"text-sm font-medium",children:s.label})]}),!x&&e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:i("h-full transition-all duration-300",s.progressColor),style:{width:`${Math.min(100,s.stat.percentage)}%`}})})}),e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:i("text-2xl font-bold",b),children:m(s.stat.current)}),!x&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground mx-1",children:"/"}),e.jsx("span",{className:"text-lg text-muted-foreground",children:m(s.stat.max)})]})]}),!x&&e.jsxs("span",{className:i("text-sm font-medium",b),children:[Math.round(s.stat.percentage),"%"]})]}),!x&&s.stat.percentage>=90&&e.jsx("div",{className:"mt-3 p-2 bg-destructive/10 border border-destructive/20 rounded text-xs text-destructive",children:"Você está próximo do limite!"})]},g)})}),e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-primary",children:"ℹ️"}),"Sobre os Limites"]}),e.jsxs("ul",{className:"space-y-1.5 text-sm text-muted-foreground",children:[t!=="ENTERPRISE"&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Os limites são resetados diariamente à meia-noite (horário local)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Jobs em tempo real contam contra o limite apenas enquanto ativos"})]}),t==="FREE"&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Faça upgrade para Premium para aumentar seus limites"})]}),t==="PREMIUM"&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Faça upgrade para Enterprise para ter limites ilimitados"})]}),t==="ENTERPRISE"&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Você tem acesso ilimitado a todos os recursos da plataforma"})]})]})]})]})}async function Ce(a){return(await F.post("/api/stripe/create-checkout-session",a)).data}const A={PREMIUM_MONTHLY:"price_1Sa3waIBNyqNGKR6pWWBkepV",PREMIUM_ANNUAL:"price_1Sa3x8IBNyqNGKR649c7u0hY",ENTERPRISE_MONTHLY:"price_1Sa3yOIBNyqNGKR6fmutj8lo",ENTERPRISE_ANNUAL:"price_1Sa3yOIBNyqNGKR6k7gLn6Aa"};async function Se(a,l,h){const t=window.location.origin,u=await Ce({price_id:a,success_url:`${t}/account?payment=success`,cancel_url:`${t}/account?payment=cancelled`});window.location.href=u.checkout_url}function Ee({isOpen:a,onClose:l,onSelectPix:h,onSelectCard:t,planName:u,formattedPrice:r}){const[m,c]=p.useState(null);if(!a)return null;const s=()=>{m==="pix"?h():m==="card"&&t()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative bg-card border border-border rounded-xl shadow-2xl w-full max-w-md mx-4 p-6 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx($,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Como deseja pagar?"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[u," • ",r]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>c("pix"),className:i("flex flex-col items-center justify-center p-6 rounded-xl border-2 transition-all duration-200",m==="pix"?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50 hover:bg-muted/50"),children:[e.jsx("div",{className:i("w-16 h-16 rounded-full flex items-center justify-center mb-3 transition-colors",m==="pix"?"bg-primary/20":"bg-muted"),children:e.jsx(fe,{className:"w-8 h-8"})}),e.jsx("span",{className:"font-semibold text-lg",children:"PIX"}),e.jsx("span",{className:"text-xs text-muted-foreground mt-1",children:"Pagamento instantâneo"})]}),e.jsxs("button",{onClick:()=>c("card"),className:i("flex flex-col items-center justify-center p-6 rounded-xl border-2 transition-all duration-200",m==="card"?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50 hover:bg-muted/50"),children:[e.jsx("div",{className:i("w-16 h-16 rounded-full flex items-center justify-center mb-3 transition-colors",m==="card"?"bg-primary/20":"bg-muted"),children:e.jsx(pe,{className:"w-8 h-8"})}),e.jsx("span",{className:"font-semibold text-lg",children:"Cartão"}),e.jsx("span",{className:"text-xs text-muted-foreground mt-1",children:"Crédito ou débito"})]})]}),e.jsx("button",{onClick:s,disabled:!m,className:i("w-full py-3 px-4 rounded-lg font-medium transition-all duration-200",m?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),children:"Continuar"})]})]})}async function _e(a){return(await F.post("/api/pagbank/create-pix-order",a)).data}async function Me(a){return(await F.get(`/api/pagbank/order-status/${a}`)).data}function Ie(a){return a.replace(/\D/g,"").length===11}function ke(a){return a.replace(/\D/g,"")}function Re({isOpen:a,onClose:l,onPaymentSuccess:h,plan:t,billingCycle:u,planName:r,formattedPrice:m}){const[c,s]=p.useState("cpf"),[g,n]=p.useState(""),[x,b]=p.useState(""),[v,S]=p.useState(!1),[f,E]=p.useState(null),[I,_]=p.useState(!1),[k,o]=p.useState("");p.useEffect(()=>{a||(s("cpf"),n(""),b(""),E(null),_(!1))},[a]);const N=j=>{let d=j.target.value.replace(/\D/g,"");d.length>11&&(d=d.slice(0,11)),d.length>9?d=`${d.slice(0,3)}.${d.slice(3,6)}.${d.slice(6,9)}-${d.slice(9)}`:d.length>6?d=`${d.slice(0,3)}.${d.slice(3,6)}.${d.slice(6)}`:d.length>3&&(d=`${d.slice(0,3)}.${d.slice(3)}`),n(d),b("")},w=async()=>{const j=ke(g);if(!Ie(g)){b("CPF deve conter 11 dígitos");return}S(!0);try{const M=await _e({plan:t,billing_cycle:u,customer_tax_id:j});E(M),s("qrcode"),y.success("QR Code gerado com sucesso!")}catch(d){console.error("Error creating PIX order:",d);const M=d?.response?.data?.detail||d?.message||"Erro ao gerar QR Code";y.error(M),b(M)}finally{S(!1)}},P=async()=>{if(f?.qr_code_text)try{await navigator.clipboard.writeText(f.qr_code_text),_(!0),y.success("Código PIX copiado!"),setTimeout(()=>_(!1),3e3)}catch{y.error("Erro ao copiar código")}},R=p.useCallback(async()=>{if(!(!f?.order_id||c!=="qrcode"))try{const j=await Me(f.order_id);j.status==="paid"?(s("success"),y.success("Pagamento confirmado!"),setTimeout(()=>{h()},2e3)):j.status==="expired"?s("expired"):j.status==="cancelled"&&s("error")}catch(j){console.error("Error checking payment status:",j)}},[f?.order_id,c,h]);return p.useEffect(()=>{if(c!=="qrcode"||!f)return;const j=setInterval(()=>{R()},5e3);return()=>clearInterval(j)},[c,f,R]),p.useEffect(()=>{if(!f?.expiration_date||c!=="qrcode")return;const j=()=>{const M=new Date,T=new Date(f.expiration_date).getTime()-M.getTime();if(T<=0){s("expired"),o("Expirado");return}const q=Math.floor(T/(1e3*60*60)),z=Math.floor(T%(1e3*60*60)/(1e3*60)),H=Math.floor(T%(1e3*60)/1e3);o(q>0?`${q}h ${z}m ${H}s`:`${z}m ${H}s`)};j();const d=setInterval(j,1e3);return()=>clearInterval(d)},[f?.expiration_date,c]),a?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:c==="success"?void 0:l}),e.jsxs("div",{className:"relative bg-card border border-border rounded-xl shadow-2xl w-full max-w-md mx-4 p-6 animate-in fade-in zoom-in-95 duration-200",children:[c!=="success"&&e.jsx("button",{onClick:l,className:"absolute top-4 right-4 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx($,{className:"w-5 h-5"})}),c==="cpf"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Pagamento via PIX"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r," • ",m]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"cpf",className:"block text-sm font-medium text-foreground mb-2",children:"CPF do pagador"}),e.jsx("input",{id:"cpf",type:"text",value:g,onChange:N,placeholder:"000.000.000-00",className:i("w-full px-4 py-3 rounded-lg border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all",x?"border-destructive":"border-border"),maxLength:14}),x&&e.jsx("p",{className:"mt-2 text-sm text-destructive",children:x})]}),e.jsx("button",{onClick:w,disabled:v||g.length<14,className:i("w-full py-3 px-4 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2",g.length>=14&&!v?"bg-primary text-primary-foreground hover:bg-primary/90":"bg-muted text-muted-foreground cursor-not-allowed"),children:v?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-5 h-5 animate-spin"}),"Gerando QR Code..."]}):"Gerar QR Code PIX"})]}),c==="qrcode"&&f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Pagamento via PIX"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Escaneie o QR code ou use o código Copia e Cola"})]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-white p-4 rounded-lg",children:e.jsx("img",{src:f.qr_code_url,alt:"QR Code PIX",className:"w-48 h-48"})})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:f.formatted_amount}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Expira em: ",e.jsx("span",{className:"font-medium text-amber-500",children:k})]})]}),e.jsx("button",{onClick:P,className:"w-full py-3 px-4 rounded-lg font-medium border border-primary text-primary hover:bg-primary/10 transition-all duration-200 flex items-center justify-center gap-2 mb-4",children:I?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5"}),"Código copiado!"]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-5 h-5"}),"Copiar código PIX"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(D,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Aguardando pagamento..."})]})]}),c==="success"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ue,{className:"w-10 h-10 text-green-500"})}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Pagamento confirmado!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Seu plano foi atualizado com sucesso."})]}),c==="expired"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-20 h-20 bg-amber-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Q,{className:"w-10 h-10 text-amber-500"})}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"QR Code expirado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"O tempo para pagamento expirou."}),e.jsx("button",{onClick:()=>{s("cpf"),E(null)},className:"w-full py-3 px-4 rounded-lg font-medium bg-primary text-primary-foreground hover:bg-primary/90 transition-all duration-200",children:"Gerar novo QR Code"})]}),c==="error"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-20 h-20 bg-destructive/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Q,{className:"w-10 h-10 text-destructive"})}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Erro no pagamento"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Ocorreu um erro ao processar seu pagamento."}),e.jsx("button",{onClick:()=>{s("cpf"),E(null)},className:"w-full py-3 px-4 rounded-lg font-medium bg-primary text-primary-foreground hover:bg-primary/90 transition-all duration-200",children:"Tentar novamente"})]})]})]}):null}const U=[{id:"FREE",name:"Gratuito",monthlyPrice:"R$ 0",annualPrice:"R$ 0",monthlyPriceCents:0,annualPriceCents:0,annualSavings:"",description:"Perfeito para começar",popular:!1,features:[{text:"Até 3 jobs históricos",included:!0},{text:"1.000 mensagens por dia",included:!0},{text:"Suporte a mídia",included:!0},{text:"Jobs em tempo real",included:!1},{text:"Suporte prioritário",included:!1}]},{id:"PREMIUM",name:"Premium",monthlyPrice:"R$ 59,90",annualPrice:"R$ 599,00",monthlyPriceCents:5990,annualPriceCents:59900,annualSavings:"Economize ~17%",description:"Para usuários ativos",popular:!0,stripePriceIdMonthly:A.PREMIUM_MONTHLY,stripePriceIdAnnual:A.PREMIUM_ANNUAL,features:[{text:"Até 20 jobs históricos",included:!0},{text:"10.000 mensagens por dia",included:!0},{text:"Suporte a mídia",included:!0},{text:"Até 5 jobs em tempo real",included:!0},{text:"Suporte prioritário",included:!0}]},{id:"ENTERPRISE",name:"Enterprise",monthlyPrice:"R$ 99,90",annualPrice:"R$ 999,00",monthlyPriceCents:9990,annualPriceCents:99900,annualSavings:"Economize ~17%",description:"Uso ilimitado",popular:!1,stripePriceIdMonthly:A.ENTERPRISE_MONTHLY,stripePriceIdAnnual:A.ENTERPRISE_ANNUAL,features:[{text:"Jobs históricos ilimitados",included:!0},{text:"Mensagens ilimitadas",included:!0},{text:"Suporte a mídia",included:!0},{text:"Jobs em tempo real ilimitados",included:!0},{text:"Suporte prioritário",included:!0}]}];function Te({currentPlan:a,className:l,onPlanUpdated:h}){const[t,u]=p.useState(!1),[r,m]=p.useState(null),[c,s]=p.useState(!1),[g,n]=p.useState(!1),[x,b]=p.useState(null),v=async o=>{if(console.log("[UpgradePlan] handleUpgrade called with plan:",o.id),o.id==="FREE"||!o.stripePriceIdMonthly){console.log("[UpgradePlan] Skipping - FREE plan or no price ID");return}b(o),s(!0)},S=()=>{s(!1),n(!0)},f=async()=>{if(s(!1),!x)return;const o=t?x.stripePriceIdAnnual:x.stripePriceIdMonthly;if(console.log("[UpgradePlan] Selected price ID:",o,"isAnnual:",t),!o){console.error("[UpgradePlan] No price ID configured"),y.error("Price ID não configurado para este plano");return}m(x.id),console.log("[UpgradePlan] Calling redirectToCheckout");try{await Se(o)}catch(N){console.error("[UpgradePlan] Erro ao redirecionar para checkout:",N),y.error("Erro ao processar pagamento. Tente novamente."),m(null)}},E=()=>{n(!1),b(null),y.success("Pagamento confirmado! Seu plano foi atualizado."),h&&h(),setTimeout(()=>{window.location.reload()},1500)},I=()=>{s(!1),n(!1),b(null)},_=()=>x?t?x.annualPrice:x.monthlyPrice:"",k=()=>{if(!x)return"";const o=t?"Anual":"Mensal";return`${x.name} ${o}`};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i("space-y-6",l),children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Escolha o Plano Ideal"}),e.jsx("p",{className:"text-muted-foreground",children:"Atualize seu plano e desbloqueie recursos adicionais"})]}),e.jsxs("div",{className:"inline-flex items-center gap-3 p-1 bg-muted rounded-lg",children:[e.jsx("button",{onClick:()=>u(!1),className:i("px-4 py-2 rounded-md text-sm font-medium transition-colors",t?"text-muted-foreground hover:text-foreground":"bg-background shadow-sm"),children:"Mensal"}),e.jsxs("button",{onClick:()=>u(!0),className:i("px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center gap-2",t?"bg-background shadow-sm":"text-muted-foreground hover:text-foreground"),children:["Anual",e.jsx("span",{className:"text-xs bg-success/10 text-success px-2 py-0.5 rounded-full",children:"Economize 17%"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:U.map(o=>{const N=o.id===a,w=U.findIndex(P=>P.id===a)<U.findIndex(P=>P.id===o.id);return e.jsxs("div",{className:i("relative bg-card border-2 rounded-lg p-6 transition-all",o.popular&&"border-primary shadow-lg scale-105",!o.popular&&"border-border",N&&"ring-2 ring-success ring-offset-2"),children:[o.popular&&!N&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 bg-primary text-primary-foreground rounded-full text-xs font-medium",children:[e.jsx(B,{className:"h-3 w-3"}),e.jsx("span",{children:"Mais Popular"})]})}),N&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2",children:e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 bg-success text-success-foreground rounded-full text-xs font-medium",children:[e.jsx(L,{className:"h-3 w-3"}),e.jsx("span",{children:"Plano Atual"})]})}),e.jsxs("div",{className:"text-center mb-6",children:[o.id!=="FREE"&&e.jsx(J,{className:i("h-8 w-8 mx-auto mb-3",o.popular?"text-primary":"text-warning")}),e.jsx("h4",{className:"text-xl font-bold mb-2",children:o.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:o.description}),e.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[e.jsx("span",{className:"text-3xl font-bold",children:t?o.annualPrice:o.monthlyPrice}),e.jsx("span",{className:"text-muted-foreground",children:t?"/ano":"/mês"})]}),t&&o.annualSavings&&e.jsx("p",{className:"text-xs text-success mt-1",children:o.annualSavings})]}),e.jsx("ul",{className:"space-y-3 mb-6",children:o.features.map((P,R)=>e.jsxs("li",{className:"flex items-start gap-2",children:[P.included?e.jsx(L,{className:"h-5 w-5 text-success flex-shrink-0 mt-0.5"}):e.jsx("div",{className:"h-5 w-5 border-2 border-muted rounded flex-shrink-0 mt-0.5"}),e.jsx("span",{className:i("text-sm",!P.included&&"text-muted-foreground"),children:P.text})]},R))}),e.jsxs("button",{onClick:()=>v(o),disabled:N||!w||r!==null,className:i("w-full py-3 px-4 rounded-md font-medium transition-colors flex items-center justify-center gap-2",N&&"bg-success/10 text-success cursor-default",!N&&w&&o.popular&&"bg-primary text-primary-foreground hover:bg-primary/90",!N&&w&&!o.popular&&"bg-muted text-foreground hover:bg-muted/80",!w&&"bg-muted/50 text-muted-foreground cursor-not-allowed",r===o.id&&"opacity-70 cursor-wait"),children:[r===o.id&&e.jsx(D,{className:"h-4 w-4 animate-spin"}),N?"Plano Atual":w?"Fazer Upgrade":"Plano Inferior"]})]},o.id)})}),e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-6",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-primary",children:"ℹ️"}),"Informações Importantes"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Aceitamos PIX (pagamento instantâneo) e Cartão de Crédito"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Todos os planos incluem suporte a cópia de mídia (fotos, vídeos, documentos)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Você pode fazer upgrade a qualquer momento sem perder seus dados"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"•"}),e.jsx("span",{children:"Jobs em tempo real permanecem ativos até serem manualmente parados"})]})]})]})]}),e.jsx(Ee,{isOpen:c,onClose:I,onSelectPix:S,onSelectCard:f,planName:k(),formattedPrice:_()}),x&&e.jsx(Re,{isOpen:g,onClose:I,onPaymentSuccess:E,plan:x.id.toLowerCase(),billingCycle:t?"annual":"monthly",planName:k(),formattedPrice:_()})]})}function Ae(){const a=ee(),l=X(n=>n.logout),h=se(n=>n.session),{accountData:t,limits:u,usage:r,isLoading:m}=ye(),[c,s]=p.useState(!1),g=async()=>{s(!0);try{await Y.logout({api_id:h?.apiId,api_hash:h?.apiHash}),y.success("Você foi desconectado"),l(),a(O.LOGIN)}catch(n){console.error("Logout error:",n),y.error("Erro ao desconectar. Fazendo logout local..."),l(),a(O.LOGIN)}finally{s(!1)}};return m?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Configurações da Conta"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie sua conta, plano e visualize estatísticas de uso"})]}),e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando dados da conta..."})]})})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Configurações da Conta"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie sua conta, plano e visualize estatísticas de uso"})]}),e.jsx("div",{className:"bg-card border rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-full",children:e.jsx(K,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:t.username||"Usuário do Telegram"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:t.phoneNumber})]})]})]}),e.jsxs("button",{onClick:g,disabled:c,className:"flex items-center gap-2 px-4 py-2 bg-destructive/10 text-destructive hover:bg-destructive/20 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:c?"Saindo...":"Sair"})]})]})}),e.jsx(Pe,{currentPlan:t.plan,limits:u,expiryDate:t.planExpiry}),e.jsx(we,{realTimeJobs:r.realTimeJobs,historicalJobs:r.historicalJobs,messagesPerDay:r.messagesPerDay,currentPlan:t.plan}),t.plan!=="ENTERPRISE"&&e.jsx(Te,{currentPlan:t.plan})]})}function Qe(){return e.jsxs("div",{className:"flex flex-col h-screen overflow-hidden",children:[e.jsx(W,{}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(Z,{}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-background",children:e.jsx("div",{className:"container mx-auto px-4 py-6 lg:px-8 max-w-6xl",children:e.jsx(Ae,{})})})]})]})}export{Qe as AccountPage};
