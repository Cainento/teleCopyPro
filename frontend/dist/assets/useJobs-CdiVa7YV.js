import{c as m,i as v,e as Q,f as n,P as c}from"./index-CzFFDwW4.js";import{u as y,j as i}from"./jobs.api-DIjWZGWd.js";import{u as p}from"./image-CaHbtvT8.js";const S=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],P=m("circle-pause",S);const E=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],q=m("circle-play",E);function k(){const o=v(),r=Q(e=>e.session),{data:u=[],isLoading:g,error:h,refetch:J}=y({queryKey:["jobs",r?.phoneNumber],queryFn:async()=>{if(!r)throw new Error("No session");return i.getJobs(r.phoneNumber)},enabled:!!r,refetchInterval:e=>e.state.data?.some(s=>s.status==="running"||s.status==="pending")?c.JOB_PROGRESS:c.JOBS_LIST,refetchIntervalInBackground:!1}),f=e=>y({queryKey:["job",e,r?.phoneNumber],queryFn:async()=>{if(!r)throw new Error("No session");return i.getJob(e)},enabled:!!r&&!!e,refetchInterval:s=>s.state.data?.status==="running"||s.state.data?.status==="pending"||s.state.data?.status==="paused"?c.JOB_PROGRESS:!1,refetchIntervalInBackground:!1}),b=p({mutationFn:async e=>{if(!r)throw new Error("No session");return i.stopJob(e)},onMutate:async e=>{n.loading("Parando job...",{id:e}),await o.cancelQueries({queryKey:["jobs"]});const s=o.getQueryData(["jobs",r?.phoneNumber]);return o.setQueryData(["jobs",r?.phoneNumber],t=>t?.map(a=>a.id===e?{...a,status:"stopped"}:a)),{previousJobs:s}},onSuccess:(e,s)=>{n.success("Job parado com sucesso",{id:s})},onError:(e,s,t)=>{n.error("Erro ao parar job",{id:s}),t?.previousJobs&&o.setQueryData(["jobs",r?.phoneNumber],t.previousJobs)},onSettled:()=>{o.invalidateQueries({queryKey:["jobs"]})}}),d=p({mutationFn:async e=>{if(!r)throw new Error("No session");return i.pauseJob(e)},onMutate:async e=>{n.loading("Pausando job...",{id:e}),await o.cancelQueries({queryKey:["jobs"]});const s=o.getQueryData(["jobs",r?.phoneNumber]);return o.setQueryData(["jobs",r?.phoneNumber],t=>t?.map(a=>a.id===e?{...a,status:"paused"}:a)),{previousJobs:s}},onSuccess:(e,s)=>{n.success("Job pausado com sucesso",{id:s})},onError:(e,s,t)=>{n.error("Erro ao pausar job",{id:s}),t?.previousJobs&&o.setQueryData(["jobs",r?.phoneNumber],t.previousJobs)},onSettled:()=>{o.invalidateQueries({queryKey:["jobs"]})}}),l=p({mutationFn:async e=>{if(!r)throw new Error("No session");return i.resumeJob(e)},onMutate:async e=>{n.loading("Retomando job...",{id:e}),await o.cancelQueries({queryKey:["jobs"]});const s=o.getQueryData(["jobs",r?.phoneNumber]);return o.setQueryData(["jobs",r?.phoneNumber],t=>t?.map(a=>a.id===e?{...a,status:"running"}:a)),{previousJobs:s}},onSuccess:(e,s)=>{n.success("Job retomado com sucesso",{id:s})},onError:(e,s,t)=>{n.error("Erro ao retomar job",{id:s}),t?.previousJobs&&o.setQueryData(["jobs",r?.phoneNumber],t.previousJobs)},onSettled:()=>{o.invalidateQueries({queryKey:["jobs"]})}}),N={total:u.length,running:u.filter(e=>e.status==="running").length,paused:u.filter(e=>e.status==="paused").length,completed:u.filter(e=>e.status==="completed"||e.status==="stopped").length,failed:u.filter(e=>e.status==="failed").length};return{jobs:u,stats:N,isLoading:g,error:h,refetch:J,useJob:f,stopJob:b.mutate,isStoppingJob:b.isPending,pauseJob:d.mutate,isPausingJob:d.isPending,resumeJob:l.mutate,isResumingJob:l.isPending}}export{P as C,q as a,k as u};
